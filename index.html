<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mi Landing con Facebook Pixel</title>

  <!-- === Meta Pixel de Facebook === -->
  <script>
    const PIXEL_ID = '1391288831895635';
    !function(f,b,e,v,n,t,s){
      if(f.fbq) return;
      n=f.fbq=function(){ n.callMethod?
        n.callMethod.apply(n, arguments):n.queue.push(arguments);
      };
      if(!f._fbq) f._fbq=n;
      n.push=n; n.loaded=!0; n.version='2.0';
      n.queue=[];
      t=b.createElement(e); t.async=!0;
      t.src=v; s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s);
    }(window, document, 'script',
      'https://connect.facebook.net/en_US/fbevents.js'
    );
    fbq('init', PIXEL_ID);
  </script>
  <!-- / Meta Pixel -->
</head>
<body>

  <h1>Bienvenido</h1>
  <p>Estamos capturando tu evento ViewContent y la cookie <code>_fbc</code>.</p>

  <script>
    // 1) Disparar ViewContent a Facebook
    fbq('track', 'ViewContent');

    // 2) Enviar evento + cookie _fbc a nuestro backend
    (function(){
      const API_URL = 'https://jxfyydlcu7.execute-api.us-east-2.amazonaws.com/Capture_fbc';

      const payload = {
        event: 'ViewContent',
        timestamp: new Date().toISOString()
      };

      fetch(API_URL, {
        method: 'POST',
        credentials: 'include',            // ← envía cookies (_fbc)
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      })
      .then(r => r.json())
      .then(console.log)
      .catch(console.error);
    })();
  </script>

</body>
</html>
