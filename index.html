<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mi Página con Facebook Pixel</title>

  <!-- === Meta Pixel de Facebook === -->
  <script>
    const PIXEL_ID = '1391288831895635';
    !function(f,b,e,v,n,t,s){
      if(f.fbq) return;
      n=f.fbq=function(){ n.callMethod?
        n.callMethod.apply(n, arguments):n.queue.push(arguments) 
      };
      if(!f._fbq) f._fbq=n;
      n.push=n; n.loaded=!0; n.version='2.0';
      n.queue=[];
      t=b.createElement(e); t.async=!0;
      t.src=v; s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)
    }(window, document, 'script',
      'https://connect.facebook.net/en_US/fbevents.js'
    );
    fbq('init', PIXEL_ID);
  </script>
  <!-- / Meta Pixel -->
</head>
<body>

  <h1>Bienvenido a mi página</h1>
  <p>Este es un ejemplo de integración del Pixel de Facebook + envío de evento al backend.</p>

  <script>
    // Disparar ViewContent en cuanto cargue la página
    fbq('track', 'ViewContent');

    // Enviar evento al backend (API Gateway), incluyendo la cookie _fbc
    (function(){
      const API_URL = 'https://jxfyydlcu7.execute-api.us-east-2.amazonaws.com/Capture_fbc';
      const payload = {
        event: 'ViewContent',
        timestamp: new Date().toISOString()
      };

      fetch(API_URL, {
        method: 'POST',
        credentials: 'include',           // Incluye cookies en la petición (p.ej. _fbc)
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(data => console.log('Respuesta del backend:', data))
      .catch(err => console.error('Error al enviar al backend:', err));
    })();
  </script>

</body>
</html>
